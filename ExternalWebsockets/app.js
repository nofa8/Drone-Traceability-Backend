'use strict';const a0_0xa5a8fb=a0_0x2f59;(function(_0x5abac7,_0x3c5635){const _0x501b8d=a0_0x2f59,_0x495f9a=_0x5abac7();while(!![]){try{const _0x35e24e=-parseInt(_0x501b8d(0x1fe))/0x1+parseInt(_0x501b8d(0x1f9))/0x2+parseInt(_0x501b8d(0x1ff))/0x3*(-parseInt(_0x501b8d(0x1f8))/0x4)+parseInt(_0x501b8d(0x20f))/0x5+parseInt(_0x501b8d(0x1e1))/0x6+parseInt(_0x501b8d(0x1dc))/0x7*(-parseInt(_0x501b8d(0x1e5))/0x8)+-parseInt(_0x501b8d(0x1f3))/0x9*(-parseInt(_0x501b8d(0x1ef))/0xa);if(_0x35e24e===_0x3c5635)break;else _0x495f9a['push'](_0x495f9a['shift']());}catch(_0x466a62){_0x495f9a['push'](_0x495f9a['shift']());}}}(a0_0x4584,0x36e31));var __rest=this&&this[a0_0xa5a8fb(0x1ed)]||function(_0x55945f,_0x1ca597){const _0x234fb8=a0_0xa5a8fb;var _0x4a381f={};for(var _0x252cb9 in _0x55945f)if(Object[_0x234fb8(0x1de)][_0x234fb8(0x204)][_0x234fb8(0x203)](_0x55945f,_0x252cb9)&&_0x1ca597['indexOf'](_0x252cb9)<0x0)_0x4a381f[_0x252cb9]=_0x55945f[_0x252cb9];if(_0x55945f!=null&&typeof Object[_0x234fb8(0x1e2)]===_0x234fb8(0x1e0))for(var _0x23f3cf=0x0,_0x252cb9=Object['getOwnPropertySymbols'](_0x55945f);_0x23f3cf<_0x252cb9[_0x234fb8(0x1ec)];_0x23f3cf++){if(_0x1ca597[_0x234fb8(0x1f4)](_0x252cb9[_0x23f3cf])<0x0&&Object[_0x234fb8(0x1de)][_0x234fb8(0x1f7)][_0x234fb8(0x203)](_0x55945f,_0x252cb9[_0x23f3cf]))_0x4a381f[_0x252cb9[_0x23f3cf]]=_0x55945f[_0x252cb9[_0x23f3cf]];}return _0x4a381f;},__importDefault=this&&this[a0_0xa5a8fb(0x1f5)]||function(_0x51f35a){const _0x337ce0=a0_0xa5a8fb;return _0x51f35a&&_0x51f35a[_0x337ce0(0x202)]?_0x51f35a:{'default':_0x51f35a};};function a0_0x4584(){const _0x2ce2cc=['add','drone','protocolVersion','32564zQZsdk','default','prototype','size','function','629244SDSHBq','getOwnPropertySymbols','from','toString','304zCPMmP','defineProperty','assign','dboidsId','map','express','Error,\x20unable\x20to\x20process\x20message:','length','__rest','has','18040fPxBzb','getProtocolVersionFromWS','getRolefromWS','encaspulateMessageJSON','1521VuLWOd','indexOf','__importDefault','role','propertyIsEnumerable','20vvXyjH','869258iaZGmq','json','./websocketUtils','connection','stringify','367458Zkdnsg','93273miXHgs','delete','store','__esModule','call','hasOwnProperty','platform','close','exports','message','userId','send','DboidsClient','forEach','set','error','400635NXxETm','decaspulateMessageJSON','socket','get'];a0_0x4584=function(){return _0x2ce2cc;};return a0_0x4584();}Object[a0_0xa5a8fb(0x1e6)](exports,a0_0xa5a8fb(0x202),{'value':!![]}),exports[a0_0xa5a8fb(0x20b)]=void 0x0;const express_1=__importDefault(require(a0_0xa5a8fb(0x1ea))),ws_1=__importDefault(require('ws')),websocketUtils_1=require(a0_0xa5a8fb(0x1fb)),app=(0x0,express_1[a0_0xa5a8fb(0x1dd)])(),PLATFORM_ID='0';class DboidsClient{constructor(_0x1d14c7,_0x518181,_0x1d0b71,_0x1446ab){const _0x38eb40=a0_0xa5a8fb;this[_0x38eb40(0x1e8)]=_0x1d14c7,this[_0x38eb40(0x1f6)]=_0x518181,this[_0x38eb40(0x1db)]=_0x1d0b71,this[_0x38eb40(0x211)]=_0x1446ab;}}function a0_0x2f59(_0x102941,_0x4360c1){const _0x4584d0=a0_0x4584();return a0_0x2f59=function(_0x2f5966,_0x42dd6b){_0x2f5966=_0x2f5966-0x1d9;let _0x1425e5=_0x4584d0[_0x2f5966];return _0x1425e5;},a0_0x2f59(_0x102941,_0x4360c1);}exports['DboidsClient']=DboidsClient;const clients=new Map(),storedDataPerDrone=new Map(),server=app['listen'](0x1f90,()=>{}),wss=new ws_1[(a0_0xa5a8fb(0x1dd))]['Server']({'server':server});wss['on'](a0_0xa5a8fb(0x1fc),(_0x20dbd1,_0x34e68a)=>{const _0x1bc917=a0_0xa5a8fb,_0x3aa53e=(0x0,websocketUtils_1['getIDfromWS'])(_0x34e68a),_0x31b2a3=(0x0,websocketUtils_1[_0x1bc917(0x1f1)])(_0x3aa53e==PLATFORM_ID,_0x34e68a),_0x13be72=(0x0,websocketUtils_1[_0x1bc917(0x1f0)])(_0x34e68a);if(_0x3aa53e){const _0x3ee2db=new DboidsClient(_0x3aa53e,_0x31b2a3,_0x13be72,_0x20dbd1);let _0x276e11;clients[_0x1bc917(0x1ee)](_0x3aa53e)?_0x276e11=clients[_0x1bc917(0x212)](_0x3aa53e):(_0x276e11=new Set(),clients['set'](_0x3aa53e,_0x276e11)),_0x276e11[_0x1bc917(0x1d9)](_0x3ee2db),_0x20dbd1['on'](_0x1bc917(0x206),()=>{const _0x2f5aae=_0x1bc917;_0x276e11['delete'](_0x3ee2db),_0x276e11[_0x2f5aae(0x1df)]===0x0&&clients[_0x2f5aae(0x200)](_0x3aa53e);}),_0x20dbd1['on'](_0x1bc917(0x208),_0x2d4461=>{const _0x19c974=_0x1bc917;var _0x320292,_0x3ecbcc,_0xd68aa2,_0x277dc4;try{const _0x5d6733=JSON['parse'](_0x2d4461);let _0x50e464=_0x5d6733[_0x19c974(0x209)];if(_0x5d6733[_0x19c974(0x208)]===_0x19c974(0x201)&&_0x5d6733['userId']){const {message:_0x51a0a7,userId:_0x38857a}=_0x5d6733,_0xe91b47=__rest(_0x5d6733,['message',_0x19c974(0x209)]),_0x3bcc9d=(_0x320292=storedDataPerDrone[_0x19c974(0x212)](_0x38857a))!==null&&_0x320292!==void 0x0?_0x320292:{},_0x4174f4=Object[_0x19c974(0x1e7)](Object['assign']({},_0x3bcc9d),_0xe91b47);storedDataPerDrone[_0x19c974(0x20d)](_0x38857a,_0x4174f4);return;}if(_0x31b2a3===_0x19c974(0x1da)){const _0x1619ac=(_0x3ecbcc=_0x5d6733[_0x19c974(0x208)])!==null&&_0x3ecbcc!==void 0x0?_0x3ecbcc:_0x5d6733,_0x143487=(_0xd68aa2=storedDataPerDrone[_0x19c974(0x212)](_0x3aa53e))!==null&&_0xd68aa2!==void 0x0?_0xd68aa2:{},_0x2bf613={'userId':_0x3aa53e,'role':_0x19c974(0x1da),'message':_0x1619ac,'store':_0x143487},_0x46a7cc=clients[_0x19c974(0x212)](PLATFORM_ID);if(_0x46a7cc)_0x46a7cc[_0x19c974(0x20c)](_0x1023ad=>{const _0x2ca03b=_0x19c974;_0x1023ad['role']===_0x2ca03b(0x205)&&_0x1023ad[_0x2ca03b(0x211)][_0x2ca03b(0x20a)](JSON[_0x2ca03b(0x1fd)](_0x2bf613));});else{}return;}const _0x2d8454=(0x0,websocketUtils_1[_0x19c974(0x1f2)])(_0x3aa53e,_0x31b2a3,_0x2d4461),_0x1276ac=(0x0,websocketUtils_1[_0x19c974(0x210)])(_0x2d4461[_0x19c974(0x1e4)]()),_0x59d898=JSON[_0x19c974(0x1fd)](_0x1276ac[_0x19c974(0x208)]);!_0x50e464&&(_0x50e464=PLATFORM_ID),(_0x277dc4=clients[_0x19c974(0x212)](_0x50e464))===null||_0x277dc4===void 0x0?void 0x0:_0x277dc4[_0x19c974(0x20c)](_0x46992e=>{const _0x52b218=_0x19c974;if(_0x46992e[_0x52b218(0x1f6)]=='drone'){_0x46992e[_0x52b218(0x211)][_0x52b218(0x20a)](_0x59d898);return;}if(_0x3ee2db[_0x52b218(0x1f6)]==_0x52b218(0x1da)||_0x46992e[_0x52b218(0x1f6)]!=_0x52b218(0x205)||_0x46992e[_0x52b218(0x1db)]!='0'){_0x46992e[_0x52b218(0x211)][_0x52b218(0x20a)](_0x2d8454);return;}});}catch(_0x2a0f4c){console[_0x19c974(0x20e)](_0x19c974(0x1eb)),console[_0x19c974(0x20e)](_0x2d4461[_0x19c974(0x1e4)]());}});}else _0x20dbd1[_0x1bc917(0x206)]();}),app[a0_0xa5a8fb(0x212)]('/',(_0x2f32c0,_0x101b00)=>{const _0x5ee9cb=a0_0xa5a8fb,_0x4861f0=Array[_0x5ee9cb(0x1e3)](clients)[_0x5ee9cb(0x1e9)](_0x5f0a89=>_0x5f0a89[0x0]);_0x101b00[_0x5ee9cb(0x1fa)](_0x4861f0);}),module[a0_0xa5a8fb(0x207)]=app;